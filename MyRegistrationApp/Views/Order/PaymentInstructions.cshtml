@model MyRegistrationApp.Order

@{
    ViewBag.Title = "Hướng Dẫn Thanh Toán VietQR";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section styles {
    <style>
        .payment-container {
            max-width: 650px;
            margin: 40px auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

            .payment-container h2 i {
                color: #A50064; /* Màu của Napas/VietQR */
            }

        .payment-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
        }

        .payment-details {
            margin: 25px 0;
            text-align: left;
            border: 1px solid #eee;
            padding: 20px;
            border-radius: 5px;
        }

            .payment-details dt {
                font-weight: 600;
                color: #555;
                margin-bottom: 5px;
            }

            .payment-details dd {
                font-size: 1.5em;
                font-weight: bold;
                margin-bottom: 20px;
                color: #333;
            }

            .payment-details .payment-content-vietqr {
                color: #A50064;
                background-color: #fce4ec;
                padding: 5px 10px;
                border-radius: 4px;
                user-select: all;
                font-family: monospace;
            }

        .qr-code-image-vietqr {
            margin: 20px 0;
            border: 5px solid #fff;
            box-shadow: 0 0 15px rgba(0,0,0,0.15);
            max-width: 100%;
            width: 280px;
        }

        .bank-info {
            margin-top: 15px;
            font-size: 1.1em;
        }
    </style>
}

<div class="payment-container">
    <h2><i class="fas fa-qrcode"></i> @ViewBag.Title</h2>
    <p class="lead">Vui lòng sử dụng ứng dụng Ngân hàng bất kỳ để quét mã VietQR bên dưới.</p>
    <p>Thông tin về số tiền và nội dung chuyển khoản sẽ được tự động điền.</p>
    <hr />

    @if (ViewBag.QrError != null)
    {
        <div class="alert alert-danger">@ViewBag.QrError</div>
    }
    else
    {
        <div class="payment-warning">
            <strong><i class="fas fa-exclamation-triangle"></i> LƯU Ý:</strong> Đảm bảo nội dung chuyển khoản trên ứng dụng ngân hàng của bạn khớp với nội dung dưới đây.
        </div>

        <div class="payment-details">
            <dl>
                <dt>SỐ TIỀN CẦN THANH TOÁN:</dt>
                <dd>@string.Format("{0:N0}", ViewBag.OrderAmount) VNĐ</dd>

                <dt>NỘI DUNG CHUYỂN KHOẢN (Đã điền tự động):</dt>
                <dd><code class="payment-content-vietqr">@ViewBag.OrderInfo</code></dd>
            </dl>
        </div>

        <div>
            @* Hiển thị ảnh QR được tạo động từ API *@
            <img src="@ViewBag.VietQrUrl" alt="Mã VietQR cho đơn hàng @Model.OrderID" class="qr-code-image-vietqr" />
            <div class="bank-info">
                <p><strong>Ngân hàng:</strong> @ViewBag.BankName</p>
                <p><strong>Chủ tài khoản:</strong> @ViewBag.BankAccountName</p>
                <p><strong>Số tài khoản:</strong> @ViewBag.BankAccountNo</p>
            </div>
        </div>
    }

    <hr />
    <p>Sau khi hoàn tất thanh toán, vui lòng nhấn vào nút bên dưới.</p>
    <a href="@Url.Action("OrderSuccess", "Order", new { id = Model.OrderID })" class="btn btn-success btn-lg">
        <i class="fas fa-check-circle"></i> Tôi đã hoàn tất thanh toán
    </a>
</div>